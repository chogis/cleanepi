---
title: "cleanepi"
output: 
  rmarkdown::html_vignette:
    df_print: "kable"
vignette: >
  %\VignetteIndexEntry{cleanepi}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE} 
knitr::opts_chunk$set(collapse = TRUE, comment = "#>", eval = FALSE,
                      fig.width = 7, fig.height = 7, fig.align = "center")
```


## An overview

No matter how many measures are taken, one must always expect  messy data from the real-world, with duplicates, errors, incomplete,  or  irrelevant formats. Data cleansing is an essential step in data analysis;  it allows to produce accurate, reliable and reproducible results. However, data cleaning is a significant barrier in data analysis because it takes a long time to complete. 

**cleanepi** is an R package to clean, curate, and standardize epidemiological data. It contains functions to perform several data cleaning tasks that an end-user would anticipate to be performed on a cluttered dataset. 

**cleanepi** is specifically designed for epidemiological data, and works with dataframe-like data structure. This vignette provides a detailed description the  functions included in the package and how to use them. 

```{r setup}
library(cleanepi)
```

## General data cleansing tasks

The main function in **cleanepi** is `clean_data()` that can perform the following tasks:

1.  Clean up column names and convert them to more sensible formats. This includes many sub-tasks such as changing a space, dot, or hyphen between two words with underscore; converting capital cases to small cases; substituting foreign characters with their corresponding English characters; and splitting a long word into multiple short words by capital characters within, if any, and connecting them with underscores.
2. Remove  empty rows and columns.
3. Remove constant columns, i.e., columns with the same value across all rows.
4. Replace missing entries with `NA`.
5.  Remove duplicated (across all columns or some specific columns) rows.
6.  Convert character columns into date if the column actually contains date values at a specific extent (default is 90% of the values are date).
7.  Detect and remove rows with subject IDs that do not comply with the expected format.

The function `clean_data()` returns a list of 2 objects:\
1. a dataframe with the cleaned data\
2. a list with  reports for all the actions  performed on the given dataset.


```{r eval=FALSE}
# IMPORTING THE TEST DATASET
test_data <- readRDS(system.file("extdata", "test_df.RDS",
                                 package = "cleanepi"))

# DEFINING THE DATA CLEANING PARAMETERS
params <- list(
  remove_duplicates = TRUE,
  target_columns = NULL,
  replace_missing = TRUE,
  na_comes_as = "-99",
  check_timeframe = TRUE,
  timeframe = as.Date(c("1973-05-29", "2023-05-29")),
  error_tolerance = 0.5,
  subject_id_col_name = "study_id",
  subject_id_format = "PS000P2",
  prefix = "PS",
  suffix = "P2",
  range = c(1, 100)
  )

# CLEAN THE INPUT DATA FRAME
res <- clean_data(
  data = test_data,
  params = params
)

cleaned_data <- res$data
cleaning_report <- res$report
```
